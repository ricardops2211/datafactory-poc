name: Ejecutar deploy ADF

on:
  push:
    branches:
      - nuevo_datafactry   # la rama desde donde disparas

jobs:
  logueo-azure-hvault:
    uses: ./.github/workflows/credentials_azure.yml
    secrets: inherit

  verify:
    needs: logueo-azure-hvault
    uses: ./.github/workflows/verify_datafactory.yml
    with:
      location: "eastus"

  deploy-azuredatafactory:
    needs: verify
    if: ${{ needs.verify.outputs.factory-status == 'exists' || needs.verify.outputs.factory-status == 'created' }}
    uses: ./.github/workflows/deploy_etl_datafactory.yml
    secrets:
      ACCOUNT_KEY: ${{ secrets.ACCOUNT_KEY }}
