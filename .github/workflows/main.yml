name: Ejecutar deploy datafactory-richie

on:
  push:
    branches:
      - datafactory-reusable   # la rama desde donde disparas

jobs:
  logueo-azure-hvault:
    uses: ricardops2211/ci-cd-reusables/.github/workflows/credentials_azure.yml@datafactory
    secrets: inherit

  verify:
    needs: logueo-azure-hvault
    uses: ricardops2211/ci-cd-reusables/.github/workflows/verify_datafactory.yml@datafactory
    with:
      location: "eastus"

  deploy-azuredatafactory:
    needs: verify
    if: ${{ needs.verify.outputs.factory-status == 'exists' || needs.verify.outputs.factory-status == 'created' }}
    uses: ricardops2211/ci-cd-reusables/.github/workflows/deploy_etl_datafactory.yml@datafactory
    secrets:
      ACCOUNT_KEY: ${{ secrets.ACCOUNT_KEY }}
