name: Ejecutar deploy ADF

on:
  push:
    branches:
      - nuevo_datafactry   # la rama desde donde disparas

jobs:
  login:
    uses: ./.github/workflows/credentials_azure.yml
    secrets: inherit

  verify:
    needs: login
    uses: ./.github/workflows/verify_datafactory.yml
    with:
      location: "eastus"   # valor por defecto si no lo pasas

  deploy:
    needs: verify
    if: ${{ needs.verify.outputs.factory-status == 'exists' || needs.verify.outputs.factory-status == 'created' }}
    uses: ./.github/workflows/deploy_etl_datafactory.yml
    secrets:
      ACCOUNT_KEY: ${{ secrets.ACCOUNT_KEY }}
