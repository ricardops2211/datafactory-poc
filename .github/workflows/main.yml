name: Ejecutar deploy ADF

on:
  push:
    branches:
      - nuevo_datafactry   # la rama desde donde disparas

jobs:
  login:
    uses: ricardops2211/datafactory-poc/.github/workflows/credentials_azure.yml@nuevo_datafactry
    secrets: inherit

  verify:
    needs: login
    uses: ricardops2211/datafactory-poc/.github/workflows/verify_datafactory.yml@nuevo_datafactry
    with:
      location: "eastus"

  deploy:
    needs: verify
    if: ${{ needs.verify.outputs.factory-status == 'exists' || needs.verify.outputs.factory-status == 'created' }}
    uses: ricardops2211/datafactory-poc/.github/workflows/deploy_etl_datafactory.yml@nuevo_datafactry
    secrets:
      ACCOUNT_KEY: ${{ secrets.ACCOUNT_KEY }}
